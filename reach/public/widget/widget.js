(()=>{var e="reachapp_clientid",t=new URL(document.currentScript.src).origin,n="#111";var a=function(){var t;return null!==(t=localStorage.getItem(e))&&void 0!==t?t:0},c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;localStorage.setItem(e,t)},o=function(e){console.log("Widget component generated.");var o=e.client,l=e.messages,s=e.settings,d=e.links,r=0;document.body.innerHTML+=e.widget,function(e){n=e.color,$("#file-upload").hide(),$("#chat-circle").css("background-color",e.color),$(".chat-submit").css("background-color",e.color),$(".chat-box-header").css("background-color",e.color),$("#widget-title").text(e.name),$("#widget-icon").attr("src","".concat(t,"/").concat(e.img_src))}(s);for(var u=io(d.socketurl),m=a(),g=0;g<l.length;g++)f(l[g],"false"==l[g].isAgent,l[g].created_at,g==l.length-1);function h(){var e=$("#chat-input").val();if(""==e.trim())return!1;var n={body:e,isWhisper:!1,isAgent:!1,senderId:m,clientId:m,attachmentId:"0",fileSize:0,fileName:"",createddtm:Date.now()};!function(e){$.ajax({type:"POST",url:"".concat(t,"/api/message/send"),dataType:"json",data:e,success:function(e){}})}(n),u.emit("send-message",n),f(n)}function f(e){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];r++;var l=new Date(c).toISOString().slice(0,19).replace("T"," "),s=a?"self":"user",d=a?"You sent this on ".concat(l):"Sent by an agent on ".concat(l),u="";if("0"==e.attachmentId||""==e.attachmentId||null==e.attachmentId)u="<div id='cm-msg-".concat(r,"' class=\"chat-msg ").concat(s,'"><div class="cm-msg-text"> ').concat(e.body," </div><small>").concat(d,"</small></div>");else{var m="".concat(t,"/api/message/download?id=").concat(e.attachmentId),g="".concat(e.fileName," (").concat(i(e.fileSize),")");u="<div id='cm-msg-".concat(r,"' class=\"chat-msg ").concat(s,'"><div class="cm-msg-text"><span class="file-name">').concat(g,'</span><a class="chat-download-link ').concat(s,'" href="').concat(m,'" target="_blank"><span title="Click to download" class="material-icons chat-download">download</span></a></div><small>').concat(d,"</small></div>")}$(".chat-logs").append(u),$(".chat-msg.self>.cm-msg-text").css("background-color",n),$("#cm-msg-"+r).hide().fadeIn(300),a&&$("#chat-input").val(""),o&&$(".chat-logs").stop().animate({scrollTop:$(".chat-logs")[0].scrollHeight},1e3)}u.emit("join-room",{room:o.clientId,clientId:o.clientId}),u.on("message",(function(e){"false"==e.isWhisper&&e.clientId==m&&f(e,"false"==e.isAgent,e.created_at)})),u.on("end-session",(function(e){m==e&&(alert("You session with the agent has ended."),$("#chat-body").remove(),c())})),u.on("allow-upload",(function(e){e.clientId==m&&(e.willAllow?$("#file-upload").show():$("#file-upload").hide())})),$("#chat-submit").click((function(e){e.preventDefault(),h()})),$("#chat-input").keyup((function(){var e={body:$("#chat-input").val(),senderId:m,clientId:m,createddtm:Date.now()};u.emit("client-typing",e)})),$("#chat-input").keypress((function(e){"13"==e.which&&h()})),$("#chat-circle").click((function(){$("#chat-circle").toggle("scale"),$(".chat-box").toggle("scale")})),$(".chat-box-header").click((function(){$("#chat-circle").toggle("scale"),$(".chat-box").toggle("scale")})),$("#file-uploader").change((function(){var e=document.getElementById("file-uploader");if(e&&e.files){var n={body:"",isWhisper:!1,isAgent:!1,senderId:m,clientId:m,attachmentId:"0",fileSize:0,fileName:"",createddtm:Date.now()},a=e.files[0],c=new FormData;c.append("file",a),c.append("document",JSON.stringify(n)),$.ajax({url:"".concat(t,"/api/message/send"),type:"post",data:c,contentType:!1,processData:!1,success:function(e){$("#file-uploader").val(""),n.attachmentId=e.attachmentId,n.fileName=e.fileName,n.fileSize=e.fileSize,u.emit("send-message",n),f(n)},fail:function(e,t,n){console.log(n)}})}}))};function i(e){if(!(e||e>0))return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}!function(){var e=document.createElement("link");if(e.rel="stylesheet",e.type="text/css",e.href="".concat(t,"/widget/style.css"),e.media="all",document.head.appendChild(e),!window.jQuery){var n=document.createElement("script");n.src="".concat(t,"/widget/vendor.js"),document.head.appendChild(n)}setTimeout((function(){var e,n=window.location.hostname,i={clientId:a(),domain:null!=n?n:"Unknown Site"};console.log("ClientId: ".concat(i.clientId)),(e=i,$.ajax({type:"POST",url:"".concat(t,"/api/client/validate"),dataType:"json",data:e,success:function(e){return e.data},fail:function(e,t,n){return console.log(n),null}})).then((function(e){if(e&&null!=e&&e.widget&&0!=(null==e?void 0:e.clientId)){e.isNew&&c(e.client.clientId);var t=document.createElement("script");t.src=e.links.socketioLib,document.head.appendChild(t),setTimeout((function(){o(e)}),500)}else console.log(e.status)}))}),1e3)}()})();