(()=>{var e="http://127.0.0.1:8000",t="reachapp_clientid",n=e+"/api/message/download?id=",a=e+"/api/message/send",c="#111",o=!1,i=0;var s=function(){var e;return null!==(e=localStorage.getItem(t))&&void 0!==e?e:0},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;localStorage.setItem(t,e)},d=function(t,d,u,m){var h=0;document.body.innerHTML+=t,$("#missed-counter").hide(),y()&&Notification.requestPermission((function(e){console.log("notification permission: "+e)})),function(t){c=t.color,$("#file-upload").hide(),$("#chat-circle").css("background-color",t.color),$(".chat-submit").css("background-color",t.color),$(".chat-box-header").css("background-color",t.color),$("#widget-title").text(t.name),$("#widget-icon").attr("src","".concat(e,"/").concat(t.img_src))}(m);for(var f=io("http://localhost:5000"),g=s(),p=0;p<u.length;p++)w(u[p],"false"==u[p].isAgent,u[p].created_at,p==u.length-1);function v(){var e=$("#chat-input").val();if(""==e.trim())return!1;var t={body:e,isWhisper:!1,isAgent:!1,senderId:g,clientId:g,attachmentId:"0",fileSize:0,fileName:"",createddtm:Date.now()};!function(e){$.ajax({type:"POST",url:a,dataType:"json",data:e,success:function(e){}})}(t),f.emit("send-message",t),w(t)}function w(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];h++;var i=new Date(a).toISOString().slice(0,19).replace("T"," "),s=t?"self":"user",l=t?"You sent this on ".concat(i):"Sent by an agent on ".concat(i),d="";if("0"==e.attachmentId||""==e.attachmentId||null==e.attachmentId)d="<div id='cm-msg-".concat(h,"' class=\"chat-msg ").concat(s,'"><div class="cm-msg-text"> ').concat(e.body," </div><small>").concat(l,"</small></div>");else{var u=n+e.attachmentId,m="".concat(e.fileName," (").concat(r(e.fileSize),")");d="<div id='cm-msg-".concat(h,"' class=\"chat-msg ").concat(s,'"><div class="cm-msg-text"><span class="file-name">').concat(m,'</span><a class="chat-download-link ').concat(s,'" href="').concat(u,'" target="_blank"><span title="Click to download" class="material-icons chat-download">download</span></a></div><small>').concat(l,"</small></div>")}$(".chat-logs").append(d),$(".chat-msg.self>.cm-msg-text").css("background-color",c),$("#cm-msg-"+h).hide().fadeIn(300),t&&$("#chat-input").val(""),o&&$(".chat-logs").stop().animate({scrollTop:$(".chat-logs")[0].scrollHeight},1e3)}function y(){return"undefined"!=typeof Notification||(console.log("Notification is not supported by this browser"),!1)}f.emit("join-room",{room:d.clientId,clientId:d.clientId}),f.on("message",(function(t){"false"==t.isWhisper&&t.clientId==g&&(w(t,"false"==t.isAgent,t.created_at),o||(i++,$("#missed-counter").show(),$("#missed-counter").text(i)),y()&&"granted"===Notification.permission&&(notify=new Notification("REACH",{icon:"".concat(e,"/assets/images/brand/reach-64.png"),body:t.body})))})),f.on("end-session",(function(e){g==e&&(alert("You session with the agent has ended."),$("#chat-body").remove(),l())})),f.on("allow-upload",(function(e){e.clientId==g&&(e.willAllow?$("#file-upload").show():$("#file-upload").hide())})),$("#chat-submit").click((function(e){e.preventDefault(),v()})),$("#chat-input").keyup((function(){var e={body:$("#chat-input").val(),senderId:g,clientId:g,createddtm:Date.now()};f.emit("client-typing",e)})),$("#chat-input").keypress((function(e){"13"==e.which&&v()})),$("#chat-circle").click((function(){$("#chat-circle").toggle("scale"),$(".chat-box").toggle("scale"),o=!0,i=0,$("#missed-counter").hide()})),$(".chat-box-header").click((function(){$("#chat-circle").toggle("scale"),$(".chat-box").toggle("scale"),o=!1,i>0&&($("#missed-counter").text(i),$("#missed-counter").show())})),$("#file-uploader").change((function(){var e=document.getElementById("file-uploader");if(e&&e.files){var t={body:"",isWhisper:!1,isAgent:!1,senderId:g,clientId:g,attachmentId:"0",fileSize:0,fileName:"",createddtm:Date.now()},n=e.files[0],c=new FormData;c.append("file",n),c.append("document",JSON.stringify(t)),$.ajax({url:a,type:"post",data:c,contentType:!1,processData:!1,success:function(e){$("#file-uploader").val(""),t.attachmentId=e.attachmentId,t.fileName=e.fileName,t.fileSize=e.fileSize,f.emit("send-message",t),w(t)},fail:function(e,t,n){console.log(n)}})}}))};function r(e){if(!(e||e>0))return"0 Bytes";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}!function(){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href="http://127.0.0.1:8000/widget/style.css",e.media="all",document.head.appendChild(e);var t=document.createElement("script");if(t.src="https://socketio.erickdelrey.rocks/socket.io/socket.io.js",document.head.appendChild(t),!window.jQuery){var n=document.createElement("script");n.src="http://127.0.0.1:8000/widget/vendor.js",document.head.appendChild(n)}setTimeout((function(){var e,t=window.location.hostname,n=window.location.href,a={clientId:s(),domain:null!=t?t:"Unknown Domain",source:null!=n?n:"Unknown Site"};(e=a,$.ajax({type:"POST",url:"http://127.0.0.1:8000/api/client/validate",dataType:"json",data:e,success:function(e){return e.data},fail:function(e,t,n){return console.log(n),null}})).then((function(e){e&&null!=e&&e.widget&&0!=(null==e?void 0:e.clientId)&&(e.isNew&&l(e.client.clientId),d(e.widget,e.client,e.messages,e.settings))}))}),1e3)}()})();